{% extends "base.html" %}
{% load i18n %}
{% load static %}

{% block navbar %}{% endblock %}

{% block title %}
  {% trans "Nosotros | ViveMedellín" %}
{% endblock %}

{% block meta_description %}
  {% blocktrans %}Descubre cómo ViveMedellín te ayuda a explorar la ciudad: filtros por zona, tipos de lugares, búsqueda inteligente y datos verificados de restaurantes, bares y experiencias.{% endblocktrans %}
{% endblock %}

{% block content %}
{% get_current_language as LANGUAGE_CODE %}
<section class="about-section">
  <div class="container py-5">
    <div class="about-main-card mx-auto">
      
      <!-- Navegación superior -->
      <nav class="d-flex justify-content-end mb-4 home-lang-switch gap-2 flex-wrap" aria-label="{% trans 'Navegación principal' %}">
        <a href="{% url 'explorer:home' %}" class="btn btn-lang-home inactive">
          {% trans "Inicio" %}
        </a>
        {% if LANGUAGE_CODE|slice:":2" == 'en' %}
          <a href="{% url 'explorer:about' %}" class="btn btn-lang-home active" aria-current="page">{% trans "Nosotros" %}</a>
        {% else %}
          <a href="{% url 'explorer:about_es' %}" class="btn btn-lang-home active" aria-current="page">{% trans "Nosotros" %}</a>
        {% endif %}
        {% include 'components/lang_switcher.html' %}
      </nav>

      <!-- Hero -->
      <header class="about-hero text-center mb-5 reveal">
        <div class="about-badge mb-3">
          <i class="bi bi-compass me-2"></i>
          {% trans "Tu guía local" %}
        </div>
        <h1 class="about-title mb-3">
          {% blocktrans trimmed %}Descubre Medellín<br><span class="title-accent">como nunca antes</span>{% endblocktrans %}
        </h1>
        <p class="about-subtitle">
          {% blocktrans trimmed %}ViveMedellín es un directorio curado de restaurantes, bares, rooftops y experiencias en Medellín y sus alrededores. Organizamos la ciudad para que encuentres lo que buscas, más rápido.{% endblocktrans %}
        </p>
      </header>

      <!-- Qué es ViveMedellín -->
      <section class="about-what mb-5 reveal" aria-labelledby="what-title">
        <h2 id="what-title" class="section-title">
          <i class="bi bi-stars me-2"></i>
          {% trans "¿Qué es ViveMedellín?" %}
        </h2>
        
        <div class="row g-4">
          <div class="col-lg-6">
            <div class="feature-card reveal-delay-1">
              <div class="feature-icon">
                <i class="bi bi-geo-alt-fill"></i>
              </div>
              <h3 class="feature-title">
                {% trans "Organizado por zonas reales" %}
              </h3>
              <p class="feature-text">
                {% blocktrans trimmed %}Navega por comunas (El Poblado, Laureles, La Candelaria...) y pueblos cercanos. Sin mapas genéricos—barrios reales.{% endblocktrans %}
              </p>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="feature-card reveal-delay-2">
              <div class="feature-icon">
                <i class="bi bi-filter-circle-fill"></i>
              </div>
              <h3 class="feature-title">
                {% trans "Filtros inteligentes" %}
              </h3>
              <p class="feature-text">
                {% blocktrans trimmed %}Filtra por tipo (restaurantes, bares, cafés, rooftops...) y características (terraza, música en vivo, pet-friendly, delivery...).{% endblocktrans %}
              </p>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="feature-card reveal-delay-3">
              <div class="feature-icon">
                <i class="bi bi-search-heart"></i>
              </div>
              <h3 class="feature-title">
                {% trans "Búsqueda semántica" %}
              </h3>
              <p class="feature-text">
                {% blocktrans trimmed %}Pregunta naturalmente: "rooftop romántico en Poblado" o "café tranquilo para trabajar". Nuestra IA entiende tu intención.{% endblocktrans %}
              </p>
            </div>
          </div>
          
          <div class="col-lg-6">
            <div class="feature-card reveal-delay-4">
              <div class="feature-icon">
                <i class="bi bi-pin-map-fill"></i>
              </div>
              <h3 class="feature-title">
                {% trans "Cerca de mí" %}
              </h3>
              <p class="feature-text">
                {% blocktrans trimmed %}Usa tu ubicación para encontrar lugares a poca distancia. Perfecto cuando ya estás afuera explorando.{% endblocktrans %}
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Cómo usar -->
      <section class="about-how mb-5 reveal" aria-labelledby="how-title">
        <h2 id="how-title" class="section-title">
          <i class="bi bi-lightning-charge me-2"></i>
          {% trans "Cómo usarlo" %}
        </h2>
        
        <div class="steps-container" role="tablist" aria-label="{% trans 'Pasos para usar ViveMedellín' %}">
          <div class="steps-nav">
            <button class="step-tab active" role="tab" aria-selected="true" aria-controls="step-panel-1" id="step-tab-1" data-step="1" tabindex="0">
              <span class="step-number">1</span>
              <span class="step-label">{% trans "Elige zona" %}</span>
            </button>
            <button class="step-tab" role="tab" aria-selected="false" aria-controls="step-panel-2" id="step-tab-2" data-step="2" tabindex="-1">
              <span class="step-number">2</span>
              <span class="step-label">{% trans "Añade filtros" %}</span>
            </button>
            <button class="step-tab" role="tab" aria-selected="false" aria-controls="step-panel-3" id="step-tab-3" data-step="3" tabindex="-1">
              <span class="step-number">3</span>
              <span class="step-label">{% trans "Explora" %}</span>
            </button>
            <button class="step-tab" role="tab" aria-selected="false" aria-controls="step-panel-4" id="step-tab-4" data-step="4" tabindex="-1">
              <span class="step-number">4</span>
              <span class="step-label">{% trans "Decide" %}</span>
            </button>
          </div>
          
          <div class="steps-panels">
            <article class="step-panel active" role="tabpanel" id="step-panel-1" aria-labelledby="step-tab-1">
              <div class="step-content">
                <h3 class="step-title">
                  {% trans "Parte de una zona" %}
                </h3>
                <p class="step-text">
                  {% blocktrans trimmed %}Desde el home, haz clic en una burbuja de área (El Poblado, Laureles, Envigado...) o usa el dropdown de Área para enfocar tu búsqueda en un barrio específico.{% endblocktrans %}
                </p>
              </div>
            </article>
            
            <article class="step-panel" role="tabpanel" id="step-panel-2" aria-labelledby="step-tab-2" hidden>
              <div class="step-content">
                <h3 class="step-title">
                  {% trans "Combina tipo + características" %}
                </h3>
                <p class="step-text">
                  {% blocktrans trimmed %}Selecciona un tipo de lugar (restaurantes, bares, cafés...) y afina con características especiales como terraza, música en vivo, pet-friendly o delivery.{% endblocktrans %}
                </p>
              </div>
            </article>
            
            <article class="step-panel" role="tabpanel" id="step-panel-3" aria-labelledby="step-tab-3" hidden>
              <div class="step-content">
                <h3 class="step-title">
                  {% trans "Usa búsqueda semántica o Cerca de mí" %}
                </h3>
                <p class="step-text">
                  {% blocktrans trimmed %}Escribe una consulta natural como "café tranquilo para trabajar" o activa Cerca de mí para encontrar lugares alrededor de tu ubicación actual.{% endblocktrans %}
                </p>
              </div>
            </article>
            
            <article class="step-panel" role="tabpanel" id="step-panel-4" aria-labelledby="step-tab-4" hidden>
              <div class="step-content">
                <h3 class="step-title">
                  {% trans "Ve los detalles y ve" %}
                </h3>
                <p class="step-text">
                  {% blocktrans trimmed %}Abre "Ver detalles" para ver fotos, rango de precios, servicios y lugares similares. Luego salta directamente a Google Maps o Waze.{% endblocktrans %}
                </p>
              </div>
            </article>
          </div>
        </div>
      </section>

      <!-- Para quién es -->
      <section class="about-audience mb-5 reveal" aria-labelledby="audience-title">
        <h2 id="audience-title" class="section-title">
          <i class="bi bi-people me-2"></i>
          {% trans "¿Para quién es?" %}
        </h2>
        
        <div class="audience-grid" role="tablist" aria-label="{% trans 'Tipos de usuario' %}">
          <button class="audience-card active" role="tab" aria-selected="true" aria-controls="audience-panel-local" id="audience-tab-local" data-audience="local">
            <div class="audience-icon"><i class="bi bi-house-heart"></i></div>
            <div class="audience-label">{% trans "Locales" %}</div>
          </button>
          <button class="audience-card" role="tab" aria-selected="false" aria-controls="audience-panel-visitor" id="audience-tab-visitor" data-audience="visitor">
            <div class="audience-icon"><i class="bi bi-airplane"></i></div>
            <div class="audience-label">{% trans "Visitantes" %}</div>
          </button>
          <button class="audience-card" role="tab" aria-selected="false" aria-controls="audience-panel-business" id="audience-tab-business" data-audience="business">
            <div class="audience-icon"><i class="bi bi-shop"></i></div>
            <div class="audience-label">{% trans "Negocios" %}</div>
          </button>
        </div>
        
        <div class="audience-panels mt-4">
          <div class="audience-panel active" role="tabpanel" id="audience-panel-local" aria-labelledby="audience-tab-local">
            <p class="audience-text">
              {% blocktrans trimmed %}Ahorra tiempo decidiendo a dónde ir. Descubre nuevos lugares en tu comuna, encuentra esa terraza perfecta para esta noche y comparte recomendaciones con amigos en un toque.{% endblocktrans %}
            </p>
          </div>
          <div class="audience-panel" role="tabpanel" id="audience-panel-visitor" aria-labelledby="audience-tab-visitor" hidden>
            <p class="audience-text">
              {% blocktrans trimmed %}Llega a Medellín con un mapa listo. Conoce qué zonas tienen la mejor vida nocturna, cafés y comida imperdible—todo organizado por barrios reales.{% endblocktrans %}
            </p>
          </div>
          <div class="audience-panel" role="tabpanel" id="audience-panel-business" aria-labelledby="audience-tab-business" hidden>
            <p class="audience-text">
              {% blocktrans trimmed %}Entiende cómo se posiciona tu zona y qué experiencias rodean tu negocio. Contáctanos para actualizar tu ficha o destacar tu lugar.{% endblocktrans %}
            </p>
          </div>
        </div>
      </section>

      <!-- Transparencia -->
      <section class="about-transparency mb-5 reveal" aria-labelledby="transparency-title">
        <h2 id="transparency-title" class="section-title">
          <i class="bi bi-shield-check me-2"></i>
          {% trans "Transparencia y Datos" %}
        </h2>
        
        <div class="transparency-content">
          <div class="transparency-item">
            <h3 class="transparency-subtitle">
              <i class="bi bi-database me-2"></i>
              {% trans "¿De dónde vienen nuestros datos?" %}
            </h3>
            <p class="transparency-text">
              {% blocktrans trimmed %}Agregamos información pública de Google Places, OpenStreetMap y contribuciones directas. Verificamos y curamos cada ficha para asegurar calidad.{% endblocktrans %}
            </p>
          </div>
          
          <div class="transparency-item">
            <h3 class="transparency-subtitle">
              <i class="bi bi-exclamation-triangle me-2"></i>
              {% trans "Aviso importante" %}
            </h3>
            <p class="transparency-text">
              {% blocktrans trimmed %}La información puede cambiar sin previo aviso. Horarios, precios y disponibilidad deben confirmarse directamente con cada establecimiento. No somos responsables por inexactitudes.{% endblocktrans %}
            </p>
          </div>
        </div>
      </section>

      <!-- Botón volver -->
      <div class="text-center mt-5 reveal">
        <a href="{% url 'explorer:home' %}" class="btn btn-back">
          <i class="bi bi-arrow-left me-2"></i>
          {% trans "Volver a explorar" %}
        </a>
      </div>

    </div>
  </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
/* ═══════════════════════════════════════════════════════════════
   ABOUT PAGE - DISEÑO PROFESIONAL
   ═══════════════════════════════════════════════════════════════ */

.about-section {
  background:
    radial-gradient(ellipse at top, rgba(17, 153, 142, 0.2) 0%, transparent 50%),
    linear-gradient(160deg, #0a1628 0%, #0a3d32 40%, #0d5f4a 100%);
  min-height: 100vh;
}

.about-main-card {
  max-width: 900px;
  background: rgba(4, 20, 12, 0.92);
  border-radius: 28px;
  padding: 2.5rem 2rem;
  border: 1px solid rgba(255, 255, 255, 0.1);
  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
  color: #e5e7eb;
}

/* Navegación */
.home-lang-switch .btn-lang-home {
  border-radius: 999px;
  padding: 0.4rem 1rem;
  font-size: 0.8rem;
  font-weight: 600;
  letter-spacing: 0.04em;
  text-transform: uppercase;
  border: 1px solid rgba(255, 255, 255, 0.25);
  background: rgba(0, 0, 0, 0.3);
  color: rgba(255, 255, 255, 0.85);
  transition: all 0.2s ease;
}

.home-lang-switch .btn-lang-home:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-1px);
}

.home-lang-switch .btn-lang-home.active {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  border-color: transparent;
  color: #0f172a;
}

/* Hero */
.about-hero {
  padding: 1rem 0 2rem;
}

.about-badge {
  display: inline-flex;
  align-items: center;
  font-size: 0.75rem;
  font-weight: 600;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: #4ade80;
  background: rgba(74, 222, 128, 0.1);
  padding: 0.5rem 1rem;
  border-radius: 999px;
  border: 1px solid rgba(74, 222, 128, 0.3);
}

.about-title {
  font-size: 2.75rem;
  font-weight: 800;
  letter-spacing: -0.03em;
  line-height: 1.1;
  color: #f8fafc;
}

.title-accent {
  background: linear-gradient(135deg, #4ade80 0%, #22d3ee 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.about-subtitle {
  max-width: 600px;
  margin: 0 auto;
  font-size: 1.1rem;
  color: #94a3b8;
  line-height: 1.6;
}

/* Section Titles */
.section-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: #f1f5f9;
  display: flex;
  align-items: center;
  margin-bottom: 1.5rem;
  padding-bottom: 0.75rem;
  border-bottom: 2px solid rgba(74, 222, 128, 0.3);
}

.section-title i {
  color: #4ade80;
  font-size: 1.3rem;
}

/* Feature Cards */
.feature-card {
  background: rgba(15, 23, 42, 0.6);
  border: 1px solid rgba(255, 255, 255, 0.08);
  border-radius: 20px;
  padding: 1.5rem;
  height: 100%;
  transition: all 0.3s ease;
}

.feature-card:hover {
  background: rgba(15, 23, 42, 0.8);
  border-color: rgba(74, 222, 128, 0.3);
  transform: translateY(-4px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
}

.feature-icon {
  width: 48px;
  height: 48px;
  border-radius: 14px;
  background: linear-gradient(135deg, rgba(74, 222, 128, 0.2), rgba(34, 211, 238, 0.1));
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 1rem;
  font-size: 1.4rem;
  color: #4ade80;
  transition: all 0.3s ease;
}

.feature-card:hover .feature-icon {
  background: linear-gradient(135deg, #11998e, #38ef7d);
  color: #0f172a;
  transform: scale(1.05);
}

.feature-title {
  font-size: 1.05rem;
  font-weight: 600;
  color: #f1f5f9;
  margin-bottom: 0.5rem;
}

.feature-text {
  font-size: 0.9rem;
  color: #94a3b8;
  margin-bottom: 0;
  line-height: 1.5;
}

/* Steps */
.steps-container {
  background: rgba(15, 23, 42, 0.5);
  border-radius: 20px;
  padding: 1.5rem;
  border: 1px solid rgba(255, 255, 255, 0.06);
}

.steps-nav {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  margin-bottom: 1.5rem;
}

.step-tab {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.6rem 1rem;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  background: transparent;
  color: #94a3b8;
  font-size: 0.85rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.25s ease;
}

.step-tab:hover {
  background: rgba(255, 255, 255, 0.05);
  border-color: rgba(255, 255, 255, 0.25);
}

.step-tab.active {
  background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
  border-color: transparent;
  color: #0f172a;
}

.step-number {
  width: 22px;
  height: 22px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.15);
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.75rem;
  font-weight: 700;
}

.step-tab.active .step-number {
  background: rgba(0, 0, 0, 0.2);
}

.step-panel {
  display: none;
  animation: fadeSlide 0.3s ease;
}

.step-panel.active {
  display: block;
}

@keyframes fadeSlide {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.step-content {
  padding: 0.5rem;
}

.step-title {
  font-size: 1.1rem;
  font-weight: 600;
  color: #f1f5f9;
  margin-bottom: 0.5rem;
}

.step-text {
  font-size: 0.95rem;
  color: #94a3b8;
  margin-bottom: 0;
  line-height: 1.6;
}

/* Audience */
.audience-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 0.75rem;
}

.audience-card {
  background: rgba(15, 23, 42, 0.6);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 16px;
  padding: 1.25rem 1rem;
  text-align: center;
  cursor: pointer;
  transition: all 0.25s ease;
}

.audience-card:hover {
  background: rgba(15, 23, 42, 0.8);
  transform: translateY(-2px);
}

.audience-card.active {
  background: linear-gradient(135deg, rgba(17, 153, 142, 0.3), rgba(56, 239, 125, 0.15));
  border-color: rgba(74, 222, 128, 0.5);
}

.audience-icon {
  font-size: 1.75rem;
  color: #4ade80;
  margin-bottom: 0.5rem;
}

.audience-label {
  font-size: 0.85rem;
  font-weight: 600;
  color: #e5e7eb;
}

.audience-panel {
  display: none;
  animation: fadeSlide 0.3s ease;
}

.audience-panel.active {
  display: block;
}

.audience-text {
  font-size: 1rem;
  color: #cbd5e1;
  line-height: 1.6;
  text-align: center;
  max-width: 500px;
  margin: 0 auto;
}

/* Transparency */
.transparency-content {
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.transparency-item {
  background: rgba(15, 23, 42, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.06);
  border-radius: 16px;
  padding: 1.25rem;
}

.transparency-subtitle {
  font-size: 0.95rem;
  font-weight: 600;
  color: #e5e7eb;
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
}

.transparency-subtitle i {
  color: #4ade80;
}

.transparency-text {
  font-size: 0.9rem;
  color: #94a3b8;
  margin-bottom: 0;
  line-height: 1.6;
}

/* Back Button */
.btn-back {
  background: transparent;
  border: 1px solid rgba(255, 255, 255, 0.25);
  color: #94a3b8;
  font-weight: 500;
  padding: 0.6rem 1.25rem;
  border-radius: 999px;
  transition: all 0.25s ease;
}

.btn-back:hover {
  background: rgba(255, 255, 255, 0.1);
  color: #fff;
  transform: translateX(-4px);
}

/* ═══════════════════════════════════════════════════════════════
   REVEAL ANIMATIONS
   ═══════════════════════════════════════════════════════════════ */

.reveal {
  opacity: 0;
  transform: translateY(20px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}

.reveal.is-visible {
  opacity: 1;
  transform: translateY(0);
}

.reveal-delay-1 { transition-delay: 0.1s; }
.reveal-delay-2 { transition-delay: 0.2s; }
.reveal-delay-3 { transition-delay: 0.3s; }
.reveal-delay-4 { transition-delay: 0.4s; }

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  .reveal {
    opacity: 1;
    transform: none;
    transition: none;
  }
  
  .feature-card,
  .step-tab,
  .audience-card,
  .btn-cta-primary,
  .btn-cta-secondary,
  .btn-back {
    transition: none;
  }
  
  .step-panel,
  .audience-panel {
    animation: none;
  }
}

/* ═══════════════════════════════════════════════════════════════
   RESPONSIVE
   ═══════════════════════════════════════════════════════════════ */

@media (max-width: 768px) {
  .about-main-card {
    padding: 1.75rem 1.25rem;
    border-radius: 20px;
  }
  
  .about-title {
    font-size: 2rem;
  }
  
  .about-subtitle {
    font-size: 1rem;
  }
  
  .steps-nav {
    flex-direction: column;
  }
  
  .step-tab {
    width: 100%;
    justify-content: flex-start;
  }
  
  .audience-grid {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }
  
  .audience-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-align: left;
    padding: 1rem;
  }
  
  .audience-icon {
    margin-bottom: 0;
    font-size: 1.5rem;
  }
  
  .cta-buttons {
    flex-direction: column;
  }
  
  .cta-buttons .btn {
    width: 100%;
  }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // ═══════════════════════════════════════════════════════════════
  // REVEAL ON SCROLL (IntersectionObserver)
  // ═══════════════════════════════════════════════════════════════
  
  const revealElements = document.querySelectorAll('.reveal');
  
  if ('IntersectionObserver' in window) {
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-visible');
          // Trigger children with delay classes
          entry.target.querySelectorAll('[class*="reveal-delay"]').forEach(child => {
            child.classList.add('is-visible');
          });
        }
      });
    }, {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    });
    
    revealElements.forEach(el => revealObserver.observe(el));
  } else {
    // Fallback: show all immediately
    revealElements.forEach(el => el.classList.add('is-visible'));
  }
  
  // ═══════════════════════════════════════════════════════════════
  // STEPS TABS (Accessible)
  // ═══════════════════════════════════════════════════════════════
  
  const stepTabs = document.querySelectorAll('.step-tab');
  const stepPanels = document.querySelectorAll('.step-panel');
  
  function activateStep(step) {
    stepTabs.forEach(tab => {
      const isActive = tab.dataset.step === step;
      tab.classList.toggle('active', isActive);
      tab.setAttribute('aria-selected', isActive);
      tab.setAttribute('tabindex', isActive ? '0' : '-1');
    });
    
    stepPanels.forEach(panel => {
      const isActive = panel.id === `step-panel-${step}`;
      panel.classList.toggle('active', isActive);
      panel.hidden = !isActive;
    });
  }
  
  stepTabs.forEach(tab => {
    tab.addEventListener('click', () => activateStep(tab.dataset.step));
    
    // Keyboard navigation
    tab.addEventListener('keydown', (e) => {
      const currentIndex = Array.from(stepTabs).indexOf(tab);
      let newIndex;
      
      if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
        e.preventDefault();
        newIndex = (currentIndex + 1) % stepTabs.length;
      } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
        e.preventDefault();
        newIndex = (currentIndex - 1 + stepTabs.length) % stepTabs.length;
      } else if (e.key === 'Home') {
        e.preventDefault();
        newIndex = 0;
      } else if (e.key === 'End') {
        e.preventDefault();
        newIndex = stepTabs.length - 1;
      }
      
      if (newIndex !== undefined) {
        stepTabs[newIndex].focus();
        activateStep(stepTabs[newIndex].dataset.step);
      }
    });
  });
  
  // ═══════════════════════════════════════════════════════════════
  // AUDIENCE TABS (Accessible)
  // ═══════════════════════════════════════════════════════════════
  
  const audienceCards = document.querySelectorAll('.audience-card');
  const audiencePanels = document.querySelectorAll('.audience-panel');
  
  function activateAudience(audience) {
    audienceCards.forEach(card => {
      const isActive = card.dataset.audience === audience;
      card.classList.toggle('active', isActive);
      card.setAttribute('aria-selected', isActive);
    });
    
    audiencePanels.forEach(panel => {
      const isActive = panel.id === `audience-panel-${audience}`;
      panel.classList.toggle('active', isActive);
      panel.hidden = !isActive;
    });
  }
  
  audienceCards.forEach(card => {
    card.addEventListener('click', () => activateAudience(card.dataset.audience));
    
    // Enter/Space support
    card.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        activateAudience(card.dataset.audience);
      }
    });
  });
});
</script>
{% endblock %}
