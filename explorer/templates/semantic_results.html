{% extends "base.html" %}
{% load i18n %}
{% load form_tags %}

{% block navbar %}{% endblock %}

{% block title %}
  {% if query %}
    {% blocktrans %}Resultados para "{{ query }}" en ViveMedellín{% endblocktrans %}
  {% else %}
    {% trans "Resultados semánticos en ViveMedellín" %}
  {% endif %}
{% endblock %}

{% block content %}
<section class="places-section">
  <div class="container py-5">
    <div class="places-main-wrapper">
      <div class="places-main-card">
        {% get_current_language as LANGUAGE_CODE %}
        <div class="d-flex justify-content-end align-items-center mb-3 px-1 flex-wrap gap-2">
          <div class="home-lang-switch d-flex flex-wrap gap-2">
            <a href="{% url 'explorer:home' %}" class="btn btn-lang-home inactive">
              {% trans "Inicio" %}
            </a>
            {% if LANGUAGE_CODE|slice:":2" == 'en' %}
              <a href="{% url 'explorer:about' %}" class="btn btn-lang-home inactive">
                {% trans "Nosotros" %}
              </a>
            {% else %}
              <a href="{% url 'explorer:about_es' %}" class="btn btn-lang-home inactive">
                {% trans "Nosotros" %}
              </a>
            {% endif %}
            {% include 'components/lang_switcher.html' %}
          </div>
        </div>

        <div class="text-center mb-4">
          <h1 class="places-title fw-bold">
            <span class="title-main">{% trans "Resultados semánticos" %}</span>
          </h1>
          <p class="lead text-white-50 mb-0">
            {% blocktrans %}Resultados inteligentes para la búsqueda{% endblocktrans %}:
            <span class="semantic-query">“{{ query }}”</span>
          </p>
        </div>

        {% if error %}
          <div class="alert alert-danger shadow-sm mb-0">
            <i class="bi bi-exclamation-triangle me-2"></i>{{ error }}
          </div>
        {% elif resultados %}
          <div class="places-grid-card mt-3">
            <div class="lugares-grid">
              {% for r in resultados %}
                <div class="lugar-card-wrapper">
                  <div class="card h-100 shadow-sm border-0 rounded-4 place-card">
                    <div class="place-card-media position-relative">
                      {% if r.imagen %}
                        <img src="{{ r.imagen }}"
                             class="card-img-top rounded-top-4"
                             alt="{% trans 'Imagen de' %} {{ r.nombre }}"
                             loading="lazy">
                      {% else %}
                        <div class="place-card-placeholder rounded-top-4 d-flex align-items-center justify-content-center">
                          <i class="bi bi-image text-muted fs-2"></i>
                        </div>
                      {% endif %}

                      {% if r.rating %}
                        <div class="place-card-rating badge rounded-pill">
                          <i class="bi bi-star-fill me-1"></i>
                          <span class="fw-semibold">{{ r.rating|floatformat:1 }}</span>
                        </div>
                      {% endif %}
                    </div>

                    <div class="card-body d-flex flex-column place-card-body">
                      <h5 class="card-title fw-semibold mb-2 place-card-title">{{ r.nombre }}</h5>

                      <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
                        {% if r.tipo %}
                          <span class="badge place-type-pill">
                            <i class="bi bi-geo-alt me-1"></i>{{ r.tipo }}
                          </span>
                        {% endif %}
                        {% if r.es_destacado %}
                          <span class="badge place-flag-pill place-flag-featured">
                            <i class="bi bi-star-fill me-1"></i>{% trans "Destacado" %}
                          </span>
                        {% endif %}
                        {% if r.es_exclusivo %}
                          <span class="badge place-flag-pill place-flag-exclusive">
                            <i class="bi bi-gem me-1"></i>{% trans "Exclusivo" %}
                          </span>
                        {% endif %}
                      </div>

                      {% if r.precio %}
                        <div class="d-flex flex-wrap align-items-center gap-3 mb-2 small place-card-meta">
                          <span class="text-muted">
                            <i class="bi bi-cash-stack me-1"></i>{{ r.precio|format_price_range }}
                          </span>
                        </div>
                      {% endif %}

                      {% if r.direccion %}
                        <div class="small text-muted mb-2 place-card-address">
                          <i class="bi bi-map me-1"></i>{{ r.direccion }}
                        </div>
                      {% endif %}

                      {% if r.comuna_nombre %}
                        <div class="small text-muted mb-2">
                          <i class="bi bi-building me-1"></i>{{ r.comuna_nombre }}
                        </div>
                      {% endif %}

                      {% if r.telefono or r.sitio_web %}
                        <div class="d-flex flex-wrap align-items-center gap-3 small place-card-contact mb-3">
                          {% if r.telefono %}
                            <span class="text-muted">
                              <i class="bi bi-telephone me-1"></i>{{ r.telefono }}
                            </span>
                          {% endif %}
                          {% if r.sitio_web %}
                            <a href="{{ r.sitio_web }}" target="_blank" rel="noopener" class="place-card-link">
                              <i class="bi bi-globe2 me-1"></i>{% trans "Sitio web" %}
                            </a>
                          {% endif %}
                        </div>
                      {% endif %}

                      {% if r.slug %}
                        <a href="{% url 'explorer:lugares_detail' r.slug %}" class="btn mt-auto w-100 rounded-pill place-card-cta">
                          <i class="bi bi-eye me-1"></i>{% trans "Ver detalles" %}
                        </a>
                      {% else %}
                        <span class="btn btn-outline-secondary disabled mt-auto w-100 rounded-pill">{% trans "Sin detalles" %}</span>
                      {% endif %}
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        {% else %}
          <div class="text-center py-5">
            <i class="bi bi-search display-4 mb-3 text-white-50"></i>
            <h3 class="text-white mb-2">{% trans "No se encontraron resultados." %}</h3>
            <p class="text-white-50 mb-0">
              {% trans "Intenta ajustar tus palabras clave o usar otros filtros en el buscador principal." %}
            </p>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block extra_css %}
<style>
/* Reutilizar estilo general de listados: mismo fondo y card contenedor */
.places-section {
    background:
        radial-gradient(circle at top, rgba(17, 153, 142, 0.25) 0%, transparent 50%),
        linear-gradient(135deg, #020617 0%, #022c22 35%, #064e3b 100%);
    min-height: 100vh;
    padding-top: 2rem;
    padding-bottom: 3rem;
}

.places-section .container {
    max-width: 1200px;
}

.places-main-wrapper {
    max-width: 1120px;
    margin: 0 auto;
}

.places-main-card {
    background: rgba(4, 20, 12, 0.75);
    border-radius: 28px;
    padding: 2.5rem 2rem;
    box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
}

@media (min-width: 992px) {
    .places-main-card {
        padding: 3rem 2.5rem;
    }
}

/* Botón principal verde reutilizable (volver / CTAs secundarios) */
.btn-gradient-purple {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    border: none;
    color: white;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
}

.btn-gradient-purple:hover {
    background: linear-gradient(135deg, #0e8678 0%, #32d86a 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
    color: white;
}

/* Botones de idioma (mismo estilo que en otras vistas) */
.home-lang-switch .btn-lang-home {
    border-radius: 999px;
    padding: 0.35rem 0.9rem;
    font-size: 0.85rem;
    font-weight: 700;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    border: 1px solid rgba(255, 255, 255, 0.35);
    background: rgba(0, 0, 0, 0.25);
    color: rgba(255, 255, 255, 0.85);
    box-shadow: 0 4px 14px rgba(0, 0, 0, 0.35);
}

.home-lang-switch .btn-lang-home.active {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    border-color: transparent;
    color: #03120a;
}

.home-lang-switch .btn-lang-home.inactive:hover {
    background: rgba(255, 255, 255, 0.18);
}

.places-title {
    font-size: 2.5rem;
    line-height: 1.3;
    letter-spacing: -0.02em;
    margin-bottom: 1rem;
    font-weight: 800;
    color: #ffffff;
    text-shadow: 
      0 0 20px rgba(56, 239, 125, 0.4),
      0 2px 4px rgba(0, 0, 0, 0.5);
    position: relative;
}

.places-title::after {
    content: '';
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 80px;
    height: 4px;
    background: linear-gradient(90deg, transparent, #11998e, #38ef7d, transparent);
    border-radius: 2px;
    box-shadow: 0 0 12px rgba(56, 239, 125, 0.6);
}

.title-main {
    background: linear-gradient(135deg, #ffffff 0%, #38ef7d 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.semantic-query {
    font-weight: 600;
    color: #a5f3fc;
}

.text-white-50 {
    color: rgba(255, 255, 255, 0.7) !important;
}

/* Card Inferior: Grid de Lugares (reutilizada) */
.places-grid-card {
    background: rgba(4, 20, 12, 0.75);
    border-radius: 28px;
    padding: 2rem 1.5rem;
    box-shadow: 0 24px 60px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.12);
    backdrop-filter: blur(18px);
    -webkit-backdrop-filter: blur(18px);
}

@media (min-width: 992px) {
    .places-grid-card {
        padding: 2.5rem 2rem;
    }
}

/* Cards de lugares en tonos blancos con detalles verdes */
.places-section .card {
    background: #ffffff;
    border-radius: 20px;
    border: 2px solid rgba(17, 153, 142, 0.2);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
}

.places-section .card-body {
    background: transparent;
}

.places-section .card-title {
    color: #0f172a;
    font-weight: 600;
}

.places-section .card-text,
.places-section .small.text-muted {
    color: #64748b !important;
}

.places-section .card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 32px rgba(17, 153, 142, 0.25) !important;
    border-color: rgba(17, 153, 142, 0.5);
}

/* Grid de lugares en resultados semánticos: lista vertical */
.lugares-grid {
  padding: 0.5rem 0;
  display: flex;
  flex-direction: column;
  gap: 1.25rem;
}

.lugar-card-wrapper {
  width: 100%;
}

@media (min-width: 992px) {
  .place-card {
    display: grid;
    grid-template-columns: 280px minmax(0, 1fr);
  }

  .place-card-media img,
  .place-card-placeholder {
    height: 100%;
    min-height: 190px;
    max-height: 220px;
    border-radius: 1.25rem 0 0 1.25rem;
  }

  .place-card-media {
    height: 100%;
  }

  .place-card-body {
    padding: 1.25rem 1.5rem;
  }
}

.place-card-media img {
    height: 190px;
    object-fit: cover;
}

.place-card-placeholder {
    height: 190px;
    background: linear-gradient(135deg, rgba(17, 153, 142, 0.1) 0%, rgba(56, 239, 125, 0.05) 100%);
}

.place-card-rating {
    position: absolute;
    right: 12px;
    bottom: 12px;
    background: #ffffff;
    color: #11998e;
    font-size: 0.8rem;
    padding: 0.35rem 0.75rem;
    box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
    border: 1px solid rgba(17, 153, 142, 0.2);
    font-weight: 600;
}

.place-card-body {
    padding-top: 0.9rem;
}

.place-card-title {
    color: #0f172a;
    font-weight: 600;
}

.place-type-pill {
    background: rgba(17, 153, 142, 0.1);
    border-radius: 999px;
    color: #11998e;
    border: 1px solid rgba(17, 153, 142, 0.3);
    font-size: 0.8rem;
    font-weight: 500;
}

.place-flag-pill {
    border-radius: 999px;
    font-size: 0.8rem;
    font-weight: 500;
}

.place-flag-featured {
    background: rgba(250, 204, 21, 0.15);
    color: #ca8a04;
    border: 1px solid rgba(250, 204, 21, 0.4);
}

.place-flag-exclusive {
    background: rgba(17, 153, 142, 0.15);
    color: #11998e;
    border: 1px solid rgba(17, 153, 142, 0.4);
}

.place-card-address {
    color: #64748b !important;
}

.place-card-meta .place-open-badge {
    background: rgba(22, 163, 74, 0.12);
    color: #16a34a;
    border: 1px solid rgba(22, 163, 74, 0.4);
}

.place-card-meta .place-closed-badge {
    background: rgba(15, 23, 42, 0.9);
    color: #e5e7eb;
    border: 1px solid rgba(148, 163, 184, 0.5);
}

.place-card-description {
    color: #4b5563;
}

.place-card-link {
    color: #0f766e;
    text-decoration: none;
}

.place-card-link:hover {
    color: #22c55e;
    text-decoration: underline;
}

.place-card-cta {
    font-weight: 600;
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    border: none;
    color: white;
    transition: all 0.3s ease;
}

.place-card-cta:hover {
    background: linear-gradient(135deg, #0e8678 0%, #32d86a 100%);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(17, 153, 142, 0.4);
    color: white;
}
</style>
{% endblock %}